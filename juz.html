<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link id="preloadImage" rel="preload" as="image">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <title>القرآن الكريم</title>
</head>

<body>

  <header class="header2">
    <a href="index.html"><div class="symbol-left"></div></a>
    <h1 id="juz-title">القرآن الكريم</h1>
    <a href="index.html"><div class="symbol-right"></div></a>
  </header>

  <!-- Horizontal scroll container -->
  <div id="image-container" class="horizontal-scroll">
      <img id="firstImage" class="quran-page" fetchpriority="high" decoding="async" alt="">
  </div>

  <script>
    async function loadPages() {
      const arabicNames = [
        'آلم','سيقول','تلك الرسل','لن تنالوا','والمحصنات','لا يحب الله','واذا سمعوا','ولو اننا','قال الملأ',
        'واعلموا','يعتذرون','وَمَا مِنْ دَابَّةٍ','وَمَا أُبَرِّئُ','رُبَمَا','سُبْحَانَ الَّذِي','قَالَ أَلَمْ',
        'اقْتَرَبَ لِلنَّاسِ','قَدْ أَفْلَحَ','وَقَالَ الَّذِينَ','أَمَّنْ خَلَقَ','أُتْلُ مَا أُوحِيَ','وَمَنْ يَقْنُتْ',
        'وَمَا لِيَ','فَمَنْ أَظْلَمُ','إِلَيْهِ يُرَدُّ','حم','قَالَ فَمَا خَطْبُكُمْ','قَدْ سَمِعَ اللَّهُ',
        'تَبَارَكَ الَّذِي','عَمَّ'
      ];

      const juzId = sessionStorage.getItem('selectedJuz') || 1;
      const folder = "juz" + String(juzId).padStart(2, '0');

      document.getElementById('juz-title').textContent =
        `جزء ${juzId} - ${arabicNames[juzId - 1]}`;

      const res = await fetch('quran_pages.json', { cache: "force-cache" });
      const data = await res.json();
      const pages = data[folder];

      const firstFile = pages[0].file;
      const firstPath = `juz_images/${folder}/${firstFile}`;

      document.getElementById("preloadImage").href = firstPath;
      document.getElementById("firstImage").src = firstPath;

      const container = document.getElementById('image-container');

      // TRUE LAZY LOADING
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            observer.unobserve(img);
          }
        });
      }, { rootMargin: "300px" });

      for (let i = 1; i < pages.length; i++) {
        const img = document.createElement('img');
        img.dataset.src = `juz_images/${folder}/${pages[i].file}`;
        img.className = "quran-page";
        img.decoding = "async";
        img.loading = "lazy";

        container.appendChild(img);
        observer.observe(img);
      }
    }

    window.onload = loadPages;
  </script>

</body>
</html>
